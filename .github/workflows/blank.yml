name: Test az cli via env

on: [push, repository_dispatch]

env:
 ADMIN_PWD: ${{ secrets.ADMIN_PWD  }}
 nsg: wls-nsg

jobs:
  build:
    runs-on: ubuntu-latest
    env:
     location: eastus
   

    steps:
    - uses: actions/checkout@v2
    - name: Run a one-line script
      run: echo Hello, world!
    - name: Run a multi-line script
      run: |
        echo Add other actions to build,
        echo test, and deploy your project.
        
    - name: Azure Login
      uses: Azure/login@v1
      with:
        creds: ${{ secrets.AZURE_CREDENTIALS }}

    - name: Initialize env variables
      run: |
       export resourceGroup=${GITHUB_RUN_ID}${GITHUB_RUN_NUMBER}
       echo ${resourceGroup} ${location}
       echo "##[set-env name=envResourceGroup;]${resourceGroup}" 
      
    - name: Query name of Network Security Group
      uses: azure/CLI@v1
      with:
        azcliversion: 2.0.72
        inlineScript: |
          nsgName=$(az network nsg show -g galia-wls -n wls-nsg --query "name")
          echo "##[set-env name=nsgName;]${nsgName}"

    - name: Verify Network Security Group
      run: |
        echo $nsgName
        nsgName=${nsgName//\"/}
        echo "expected name is:" ${nsg} "actual:" ${nsgName}        
        [ ${nsgName} != ${nsg} ] 
        echo $?
